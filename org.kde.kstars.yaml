id: org.kde.kstars
runtime: org.kde.Platform
runtime-version: '5.11'
sdk: org.kde.Sdk
command: kstars
rename-icon: kstars
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --device=all
  - --share=network
cleanup:
  - /include
  - /lib/pkgconfig
  - /lib/cmake
  - /share/aclocal
  - /share/man
  - /share/info
  - '*.a'
  - '*.la'
modules:
  - shared-modules/udev/udev-175.json

  - name: libusb
    config-opts:
      - --disable-static
    sources:
      - type: archive
        url: https://sourceforge.net/projects/libusb/files/libusb-1.0/libusb-1.0.21/libusb-1.0.21.tar.gz
        sha256: 1a5b08c05bc5e38c81c2d59c29954d5916646f4ff46f51381b3f624384e4ac01

  - name: libnova
    rm-configure: true
    sources:
      - type: script
        dest-filename: autogen.sh
        commands: 
          - autoreconf -i
      - type: archive
        url: https://sourceforge.net/projects/libnova/files/libnova/v%200.15.0/libnova-0.15.0.tar.gz
        sha256: 7c5aa33e45a3e7118d77df05af7341e61784284f1e8d0d965307f1663f415bb1

  - name: gsl
    config-opts:
      - --disable-static
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://ftpmirror.gnu.org/gnu/gsl/gsl-2.5.tar.gz
        sha256: 0460ad7c2542caaddc6729762952d345374784100223995eb14d614861f2258d

  - name: cfitsio
    make-args:
      - shared
    sources:
      - type: archive
        url: http://heasarc.gsfc.nasa.gov/FTP/software/fitsio/c/cfitsio3450.tar.gz
        sha256: bf6012dbe668ecb22c399c4b7b2814557ee282c74a7d5dc704eb17c30d9fb92e

  - name: indi
    buildsystem: cmake-ninja
    builddir: true
    subdir: libindi
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DUDEVRULES_INSTALL_DIR=/app/lib/udev/rules.d
    sources:
      - type: archive
        url: https://github.com/indilib/indi/archive/v1.7.4.tar.gz
        sha256: 214132d011ca4cf72cb6408dae0a3b6f96fed1e8ef988738b4b50c64916c3d99

  - name: eigen
    buildsystem: cmake-ninja
    builddir: true
    cleanup:
      - '*'
    sources:
      - type: archive
        url: https://bitbucket.org/eigen/eigen/get/3.3.5.tar.bz2
        sha256: 7352bff3ea299e4c7d7fbe31c504f8eb9149d7e685dec5a12fbaa26379f603e2

  - name: xplanet
    sources:
      - type: archive
        url: https://sourceforge.net/projects/xplanet/files/xplanet/1.3.1/xplanet-1.3.1.tar.gz
        sha256: 4380d570a8bf27b81fb629c97a636c1673407f4ac4989ce931720078a90aece7
      - type: patch
        path: xplanet-1.3.1-remove-null-comparison.patch
      - type: patch
        path: xplanet-1.3.1-giflib.patch
      - type: shell
        commands:
          - cp -p /usr/share/automake-*/config.{sub,guess} .

  - name: cython
    buildsystem: simple
    build-commands:
      - python2 setup.py install --prefix=/app
    cleanup:
      - '*'
    sources:
      - type: archive
        url: https://github.com/cython/cython/archive/0.28.5.tar.gz
        sha256: bcd6a24ca0cba54ad8b1755852bb5cd567bb06abea6f776c82fbb10bb46bae37

  - name: numpy
    buildsystem: simple
    build-commands:
      - python2 setup.py install --prefix=/app --root=/
    sources:
      - type: archive
        url: https://github.com/numpy/numpy/archive/v1.15.1.tar.gz
        sha256: 8fb9ebbeda083cc99feba86b6da7e0a12a1442e62a53e9e94790d6d9e78cd695

  - name: astrometry-net
    buildsystem: simple
    build-commands:
      - make -j $FLATPAK_BUILDER_N_JOBS
      - make -j $FLATPAK_BUILDER_N_JOBS py
      - make -j $FLATPAK_BUILDER_N_JOBS extra
      - make install INSTALL_DIR=/app
    cleanup:
      - /data
      - /doc
      - /examples
    sources:
      - type: archive
        url: https://github.com/dstndstn/astrometry.net/releases/download/0.75/astrometry.net-0.75.tar.gz
        sha256: ed2968a1e122ab7aecc07a3fb4b8a4a5fd5bc7e69b6f1d56b2be56c1708f1371

  - name: libraw
    config-opts:
      - --disable-static
    cleanup:
      - /bin
      - /share/doc
    sources:
      - type: archive
        url: https://www.libraw.org/data/LibRaw-0.18.13.tar.gz
        sha256: cb1f9d0d1fabc8967d501d95c05d2b53d97a2b917345c66553b1abbea06757ca

  - name: wcslib
    sources:
      - type: archive
        url: ftp://ftp.atnf.csiro.au/pub/software/wcslib/wcslib-5.19.1.tar.bz2
        sha256: 59b9f0e5a2c040773cc846c684d84c09b986c1393e97b378a41b92d9d3df0f98

  - name: qtkeychain
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DBUILD_TRANSLATIONS=NO
      - -DCMAKE_INSTALL_LIBDIR=/app/lib
      - -DLIB_INSTALL_DIR=/app/lib
    cleanup:
      - /mkspecs
    sources:
      - type: archive
        url: https://github.com/frankosterfeld/qtkeychain/archive/v0.9.1.tar.gz
        sha256: 9c2762d9d0759a65cdb80106d547db83c6e9fdea66f1973c6e9014f867c6f28e

  - name: qtdatavis3d
    buildsystem: qmake
    builddir: true
    make-install-args:
      - INSTALL_ROOT=/app/qtdatavis3d
    post-install:
      - cp -R /app/qtdatavis3d/usr/* /app
      - rm -rf /app/qtdatavis3d
      - sed -i 's|/usr/|/app/|' /app/lib/cmake/Qt5DataVisualization/Qt5DataVisualizationConfig.cmake
    sources:
      - type: archive
        url: http://download.qt.io/official_releases/qt/5.11/5.11.2/submodules/qtdatavis3d-everywhere-src-5.11.2.tar.xz
        sha256: 67b499d2aa3cfb9cca33c08d89623d997ed92de5307745b6a2b2c3be61deff16

  - name: kstars
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    sources:
      - type: archive
        url: https://download.kde.org/stable/kstars/kstars-2.9.8.tar.xz
        sha256: 95f36cae6cc84d5d745b13cf690b56ea8ba27012faef1f901191d89007232d7d
      - type: patch
        path: kstars-2.9.8-flatpak-paths.patch
